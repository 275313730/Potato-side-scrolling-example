!function(t){var e={};function i(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function n(t){const e=h.context,i=Math.floor;let n=null,a=(e,i,n)=>{Object.defineProperties(t,{drawWidth:{value:e},drawHeight:{value:i}}),n&&(t.width=e,t.height=i)},o=()=>({relX:t.relX,relY:t.relY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,width:t.width,drawWidth:t.drawWidth,drawHeight:t.drawHeight,scale:t.scale,direction:t.direction}),s=t=>{const{relX:n,relY:a,offsetLeft:s,offsetTop:l,width:d,drawWidth:c,drawHeight:u,scale:f,direction:p}=o();if("right"===p){const o=i(n+s),h=i(a+l);e.drawImage(t,0,0,c,u,o,h,c*f,u*f)}else{const o=i(h.width-d-n+s),p=i(a+l);r(h.width,()=>{e.drawImage(t,0,0,c,u,o,p,c*f,u*f)})}};function r(t,i){e.translate(t,0),e.scale(-1,1),i(),e.translate(t,0),e.scale(-1,1)}return{animation(t,s,l=!1){const d=h.asset.get(t,s);a(d.width,d.image.height,l);let c=0,u=0,f=Object.defineProperties({},{animationFrames:{value:d.image.width/d.width-1},animationInterval:{value:d.interval||h.animationInterval},width:{value:d.width},height:{value:d.image.height},flip:{value:d.flip},onComplete:{value:null,writable:!0}});return n=()=>{((t,n,a)=>{const{relX:s,relY:l,offsetLeft:d,offsetTop:c,width:u,drawWidth:f,drawHeight:p,scale:g,direction:m}=o();if(!n&&"right"===m||n&&"left"===m){const n=i(s+d),o=i(l+c);e.drawImage(t,a*f,0,f,p,n,o,f*g,p*g)}else{const n=i(h.width-u*g-s+d),o=i(l+c);r(h.width,()=>{e.drawImage(t,a*f,0,f,p,n,o,f*g,p*g)})}})(d.image,f.flip,u),c++,c>=f.animationInterval&&(c=0,u++,u>=f.animationFrames&&(u=0,f.onComplete&&f.onComplete.call(this)))},f},clear(){n=null},draw(e){n=()=>e.call(t,h.context)},image(t,e,i=!1){const o=h.asset.get(t,e);a(o.width,o.height,i),n=()=>{s(o)}},mix(t,e){const i=h.canvas.cloneNode(),a=i.getContext("2d");let o=new Image;"static"===t?(a.clearRect(0,0,h.width,h.height),e(a),o.src=i.toDataURL("image/png"),n=()=>{h.context.drawImage(o,0,0)}):"dynamic"===t&&(n=()=>{a.clearRect(0,0,h.width,h.height),e(a),o.src=i.toDataURL("image/png"),h.context.drawImage(o,0,0)})},particle(e,i,a,o,r){const l=h.asset.get(e,i);let d,c;Object.defineProperties(t,{width:{value:0},height:{value:0},drawWidth:{value:l.width},drawHeight:{value:l.height}}),o&&(d=(o[1]-o[0])/a),r&&(c=(r[1]-r[0])/a,t.scale=r[1]),n=()=>{null!=d&&((t.alpha+d<=o[0]||t.alpha+d>=o[1])&&(d=-d),t.alpha+=d),null!=c&&((t.scale+c<=r[0]||t.scale+c>=r[1])&&(c=-c),t.scale+=c),s(l)}},render(){const e=h.width,i=h.height,a=t.relX,o=t.relY,s=t.width,r=t.height,l=t.scale;a+s*l<0||a>e||o+r*l<0||o>i||(h.context.globalAlpha=t.alpha,n&&n(),h.test&&(h.context.strokeStyle="red",h.context.strokeRect(t.relX,t.relY,t.width,t.height)))}}}i.r(e);class a{constructor(t){this.beforeCreate=t.beforeCreate,this.created=t.created,this.beforeUpdate=t.beforeUpdate,this.updated=t.updated,this.beforeDestroy=t.beforeDestroy,this.destroyed=t.destroyed,this.beforeCreate&&this.beforeCreate();const e=t.config;if(this.id=e.id,this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0,this.offsetLeft=e.offsetLeft||0,this.offsetTop=e.offsetTop||0,this.global=e.global||!1,this.alpha=null==e.alpha?1:e.alpha,this.scale=null==e.scale?1:e.scale,this.direction=e.direction||"right",this.layer=e.layer||0,this.disabled=e.disabled||!1,this.fixed=e.fixed||0,null==this.id)throw new Error("Sprite needs an id.");if(this.id instanceof Number||!isNaN(Number(this.id)))throw new Error("Sprite must start with a letter.");for(const e in t.data)this[e]=t.data[e];for(const e in t.methods)this[e]=t.methods[e];this.graphics=n(this),this.audio=function(t){let e={audio:null},i=[];return{cal(){if(!e.audio&&0===i.length)return;const n=t.relX,a=t.relY,o=Math.sqrt(n*n+a*a);if(e.audio&&e.range>0){const t=e.range,i=e.audio;i.volume=o>=t?0:e.defalutVolume*((t-o)/t)}for(let t=0;t<i.length;t++){const e=i[t],n=e.range,a=e.audio;!0!==a.ended?n&&(a.volume=o>=n?0:e.defalutVolume*((n-o)/n)):(i.splice(t,1),a.remove(),t--)}},play(t){const n=t.type,a=t.group,o=t.name,s=t.range||0,r=t.volume||1,l=t.startTime||0,d=t.loop||!0,c=h.asset.get(a,o);if("sound"===n){const t=c.cloneNode();return t.volume=r,t.currentTime=l,t.play(),void i.push({audio:t,defalutVolume:r,range:s})}"music"===n&&(e.audio!==c&&(e.audio=c,e.defalutVolume=r,e.range=s,c.currentTime=l,c.volume=r,c.loop=d),c.play())},stop(){e.pause(),e.currentTime=0},delAll(){e.audio&&e.audio.remove(),i.forEach(t=>{t.audio.remove()})}}}(this),this.event=function(t){let e={};return{add(t,i){e[t]||(e[t]=i)},del(t){e[t]&&delete e[t]},delAll(){e={}},execute(){if(!t.disabled)for(const i in e)e[i].call(t)}}}(this),this.userEvent=function(t){const e=h.userEvents;return{watch(i,n){e[t.id]||(e[t.id]={}),e[t.id][i]=n.bind(t)},unwatch(i){i&&e[t.id]&&e[t.id][i]&&delete h.userEvents[t.id][i]}}}(this),a.mixins&&a.mixins.forEach(t=>{t.call(this)}),h.unit.add(this),t.created&&t.created.call(this)}}function o(t){let e={},i=[];return{add(n){if(e[n.id])throw new Error(`Sprite '${n.id}' exists.`);return Object.defineProperties(n,{game:{value:{width:t.width,height:t.height}},stage:{value:{width:t.stage.width,height:t.stage.height}}}),e[n.id]=n,-1===i.indexOf(n.layer)&&(i.push(n.layer),i.sort()),function(){let t={};i.forEach(i=>{for(const n in e){const a=e[n];a.layer===i&&(t[a.id]=a,delete e[n])}}),e=t}(),n},create(t){new a(t)},del(i){const n=e[i];if(!n)throw new Error(`Unit ${i} doesn't exist`);n.beforeDestroy&&n.beforeDestroy(),delete t.userEvents[i],n.audio.delAll(),delete e[i],n.destroyed&&n.destroyed()},delAll(t){if(t)for(const t in e)this.del(t);else{let t=this.filter(t=>!t.global);for(const e in t)this.del(e)}},find:t=>e[t],filter(t){let i={};for(const n in e){const a=e[n];!0===t(a)&&(i[n]=a)}return i},travel(t){for(const i in e)if(!1===t(e[i]))break}}}function s(t,e){t.mixins||(t.mixins=[]),t.mixins.push(e)}class h{static init(t){function e(t,e){const i=h.userEvents;for(const n in i){const a=i[n];a[t]&&a[t](e)}}Object.defineProperties(this,{canvas:{value:document.getElementById(t.el)},context:{value:document.getElementById(t.el).getContext("2d")},width:{value:t.width},height:{value:t.height},key:{value:null,writable:!0},userEvents:{value:{}},animationInterval:{value:t.animationInterval||16,writable:!0},test:{value:!1,writable:!0},isMobile:{value:r()},imagePath:{value:t.path?t.path.image:"",writable:!0},audioPath:{value:t.path?t.path.audio:"",writable:!0}}),this.asset=function(t,e){let i=[],n={};return{allLoaded(t){i.length>0?Promise.all(i).then(()=>t()):t()},get:(t,e)=>n[t][e],load(a){const o=a.type,s=a.group,h=a.name,r=a.url;if(n[s]||(n[s]={}),!n[s][h])if("image"!==o)if("animation"!==o)"audio"===o&&(n[s][h]=new Audio(e+r));else{const e=new Image;e.src=t+r;const o=new Promise(t=>{e.onload=()=>{n[s][h]={image:e,width:a.width,interval:a.interval,flip:a.flip},t(!0)}});i.push(o)}else{const e=new Image;e.src=t+r;const a=new Promise(t=>{e.onload=()=>{n[s][h]=e,t(!0)}});i.push(a)}}}}(this.imagePath,this.audioPath),this.unit=o(h),this.mix=s,this.canvas.setAttribute("width",this.width+"px"),this.canvas.setAttribute("height",this.height+"px"),window.addEventListener("keydown",t=>{t.stopPropagation(),t.preventDefault(),h.key!==t.key&&(h.key=t.key,e("keydown",t.key))}),window.addEventListener("keyup",t=>{t.stopPropagation(),t.preventDefault(),h.key===t.key&&(h.key=null),e("keyup",t.key)}),window.addEventListener("mousedown",t=>{t.stopPropagation(),t.preventDefault(),h.isMobile||e("mousedown",l(t))}),window.addEventListener("mouseup",t=>{t.stopPropagation(),t.preventDefault(),h.isMobile||e("mousedown",l(t))}),window.addEventListener("touchstart",t=>{e("touchstart",d(t))}),window.addEventListener("touchmove",t=>{e("touchmove",d(t))}),window.addEventListener("touchend",t=>{e("touchend",d(t))}),window.oncontextmenu=function(){return!1}}}function r(){var t,e={trident:(t=navigator.userAgent).indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:t.indexOf("MicroMessenger")>-1,qq:" qq"==t.match(/\sQQ/i)};(navigator.browserLanguage||navigator.language).toLowerCase();return!!(e.mobile||e.ios||e.android||e.iPhone||e.iPad)}function l(t){const e=h.canvas,i=e.clientHeight/h.height;return{x:(t.clientX-e.offsetLeft)/i,y:(t.clientY-e.offsetTop)/i,button:t.button}}function d(t){const e=h.canvas,i=e.clientHeight/h.height;let n=[];for(let a=0;a<t.targetTouches.length;a++){const o=t.targetTouches[a];n.push({x:(o.clientX-e.offsetLeft)/i,y:(o.clientY-e.offsetTop)/i,id:o.identifier,type:t.type})}return n}function c(t){let e={x:0,y:0,scale:1,follow:null,movement:null},i=(i,n,a,o,s=!0)=>{let r=a*h.frames||1,l=i/r,d=n/r;if(0===l&&0===d)return;e.follow=null;const c=t.width,u=h.width;e.x<0&&(e.x=0),e.x>c-u&&(e.x=c-u);let f=0;!0===s&&h.unit.travel(t=>{t.disabled=!0}),e.movement=()=>{if(e.x+=l,e.y+=d,f++,f>r||e.x<=0||e.x>=c-u)return e.movement=null,!0===s&&h.unit.travel(t=>{t.disabled=!1}),void(o&&o())}};function n(e){const i=e.x,n=e.y,a=e.width,o=e.height,s=t.width,r=t.height,l=h.width,d=h.height;let c,u;return c=i<(l-a)/2?0:i>s-(l+a)/2?s-l:i-(l-a)/2,u=n<(d-o)/2?0:n>r-(d+o)/2?r-d:n-(d-o)/2,{x:c,y:u}}return{follow(t){t!==e.follow&&(e.follow=t)},get:()=>((()=>{const t=e.follow;if(t){const i=n(t);e.x=i.x,e.y=i.y}else e.movement&&e.movement()})(),Object.assign({},e)),move(t,e,n,a){i(t,e,n,a)},moveTo(t,a,o){const{x:s,y:h}=n(t);i(s-e.x,h-e.y,a,o)},unFollow(){e.follow=null}}}class u{constructor(t){h.asset.allLoaded(()=>{h.stage&&h.stage.execute.destory(),this.beforeCreate=t.beforeCreate,this.created=t.created,this.beforeUpdate=t.beforeUpdate,this.updated=t.updated,this.beforeDestroy=t.beforeDestroy,this.destoryed=t.destoryed,this.beforeCreate&&this.beforeCreate(),h.key=null,h.stage=this;const e=t.config;this.width=e&&e.width||h.width,this.height=e&&e.height||h.height,this.camera=c(this),this.event=function(t){let e={};return{add(i,...n){e[i.name]&&reutrn,e[i.name]=i.bind(t,...n)},del(t){e[t]&&delete e[t]},once(i,...n){e[i.name]||(e[i.name]=()=>{i.call(t,...n),delete e[i.name]})},execute(){for(const i in e)e[i].call(t)}}}(this),this.geometry=function(){function t(t,e){return{x1:t.x,y1:t.y,w1:t.width,h1:t.height,x2:e.x,y2:e.y,w2:e.width,h2:e.height}}return{above(e,i){const{x1:n,y1:a,w1:o,h1:s,x2:h,y2:r,w2:l,h2:d}=t(e,i);return a+s<=r&&n+o>=h&&n<=h+l},contain(e,i){const{x1:n,y1:a,w1:o,h1:s,x2:h,y2:r,w2:l,h2:d}=t(e,i);return!(o<l&&s<d&&(n<=h||n+o>=h+l)&&(a<=r||a+s>=r+d))},distance(e,i,n){const{x1:a,y1:o,w1:s,h1:h,x2:r,y2:l,w2:d,h2:c}=t(i,n);return"y"===e?l>o+h?l-(o+h):o>l+c?o-(l+c):0:"x"===e?r>a+s?r-(a+s):a>r+d?a-(r+d):0:void 0},intersect(e,i){const{x1:n,y1:a,w1:o,h1:s,x2:h,y2:r,w2:l,h2:d}=t(e,i);return!(n>=h+l||n+o<=h||a>=r+d||a+s<=r)},onRight(e,i){const{x1:n,y1:a,w1:o,h1:s,x2:h,y2:r,w2:l,h2:d}=t(e,i);return n>=h+l&&a+s>=r&&a<=r+d},onLeft(e,i){const{x1:n,y1:a,w1:o,h1:s,x2:h,y2:r,w2:l,h2:d}=t(e,i);return n+o<=h&&a+s>=r&&a<=r+d},tangent(e,i){const{x1:n,y1:a,w1:o,h1:s,x2:h,y2:r,w2:l,h2:d}=t(e,i);return!(n>h+l||n+o<h||a>r+d||a+s<r)},under(e,i){const{x1:n,y1:a,w1:o,h1:s,x2:h,y2:r,w2:l,h2:d}=t(e,i);return a>=r+d&&n+o>=h&&n<=h+l}}}(),this.execute=function(t){let e=!1;function i(){if(e)return;t.beforeUpdate&&t.beforeUpdate(),h.context.clearRect(0,0,h.width,h.height);let n=t.camera.get();t.event.execute(),h.unit.travel(t=>{!function(t,e){t.beforeUpdate&&t.beforeUpdate(),t.relX=t.x-e.x*(1-t.fixed),t.relY=t.y-e.y*(1-t.fixed),t.audio.cal(),t.graphics.render(),t.event.execute(),t.updated&&t.updated()}(t,n)}),t.updated&&t.updated(),window.requestAnimationFrame(i)}return{destory(){t.beforeDestroy&&t.beforeDestroy(),e=!0,h.unit.delAll(),t.destoryed&&t.destoryed()},loop(){i()}}}(this),u.mixins&&u.mixins.forEach(t=>{t.call(this)}),this.created&&this.created.call(this),this.execute.loop()})}}function f(){return{config:{id:"player",x:10,y:66,width:28,height:30,offsetLeft:-19,offsetTop:-13,direction:"right",layer:2},data:{exp:0,collie:null,state:"stop",speed:2,waiting:!1,attacking:!1,walkDirection:null,vSpeed:0},methods:{walk(){this.direction=this.walkDirection,this.graphics.animation(this.id,"walk")},stop(){this.graphics.animation(this.id,"idle")},attack(){this.event.add("wait",this.wait(4,()=>{this.attacking=!0,this.graphics.animation(this.id,"attack").onComplete=()=>{this.restore()}}))},jump(){this.graphics.image(this.id,"jump"),this.vSpeed=8},fall(){this.jumpTop=this.y,this.graphics.image(this.id,"fall")},ground(){this.vSpeed=0,this.y-this.jumpTop>96?(this.graphics.image(this.id,"ground"),this.event.add("wait",this.wait(6,()=>{this.restore()}))):this.restore()},hit(){this.graphics.animation(this.id,"hit").onComplete=()=>{this.event.add("wait",this.wait(8,()=>{this.restore()}))}},restore(){this.waiting=!1,this.attacking=!1,this.$pox.set("jump",()=>!1),this.$pox.set("attack",()=>!1),this.walkDirection?this.$potate.setState("walk"):this.$potate.setState("stop")},wait(t,e){let i=0;return this.waiting=!0,()=>{i++,i>=t&&(this.event.del("wait"),e())}}},created(){t.call(this),e.call(this),i.call(this)}};function t(){this.userEvent.watch("touchstart",n),this.userEvent.watch("touchmove",n),this.userEvent.watch("touchend",n),this.event.add("walkMove",a),this.event.add("jumpMove",o)}function e(){const t=this.$potate.addState;t("stop",this.stop),t("walk",this.walk),t("ground",this.ground,t=>!this.waiting&&("stop"===t||"walk"===t||void 0)),t("attack",this.attack,t=>!this.waiting&&("stop"===t||"walk"===t||void 0)),t("jump",this.jump,t=>{if("fall"===t)return!0}),t("fall",this.fall,t=>{if("ground"===t)return!0}),t("hit",this.hit,t=>{if("stop"===t)return!0}),this.$potate.setState("stop")}function i(){const t=this.$pox.watch,e=this.$potate.setState,i=this.$potate.getState;t("deaths",()=>{this.$pox.set("player.exp",t=>t+1)}),t("walk",t=>{this.walkDirection=t,null!==t?"walk"===i()?this.direction=t:e("walk"):"walk"===i()&&e("stop")}),t("jump",t=>{t&&e("jump")}),t("attack",t=>{t&&e("attack")})}function n(t){this.$pox.set("touch",()=>t)}function a(){const t=this.$potate.getState();this.walkDirection&&"attack"!==t&&"ground"!==t&&("right"===this.direction&&this.x<this.stage.width-this.width?this.x+=this.speed:"left"===this.direction&&this.x>0&&(this.x-=this.speed))}function o(){const t=this.$potate.getState();"jump"!==t&&"fall"!==t||(this.y-=this.vSpeed,this.vSpeed>-4&&(this.vSpeed-=.5,0===this.vSpeed&&this.$potate.setState("fall")))}}function p(t,e){return"block"===t?{config:{id:"block"+Math.random(),x:32*e[1],y:32*e[2],layer:1,width:32*e[3],height:32*e[4]},data:{type:t,collieType:e[0]}}:{config:{id:"flat"+Math.random(),x:32*e[0],y:32*e[1],layer:1,width:32*e[2],height:10},data:{type:t,collieType:8}}}function g(t,e){for(const i in e){const n=e[i];switch(n.collieType){case 8:if(this.geometry.above(t,n)&&this.geometry.distance("y",t,n)<-t.vSpeed)return t.collie=8,t.y=n.y-t.height,void("fall"===t.$potate.getState()&&t.$potate.setState("ground"));break;case 9:if(this.geometry.above(t,n)){if(this.geometry.distance("y",t,n)<-t.vSpeed)return t.collie=8,t.y=n.y-t.height,void("fall"===t.$potate.getState()&&t.$potate.setState("ground"))}else this.geometry.intersect(t,n)&&(t.collie=6,t.x=n.x+n.width);break;case 6:this.geometry.intersect(t,n)&&(t.collie=6,t.x=n.x+n.width);break;case 3:if(2===t.collie&&t.vSpeed>=0)return void(t.y=n.y+n.height);if(this.geometry.under(t,n)){if(this.geometry.distance("y",t,n)<t.vSpeed)return t.collie=2,void(t.y=n.y+n.height)}else if(this.geometry.intersect(t,n))return t.collie=6,void(t.x=n.x+n.width);break;case 2:this.geometry.intersect(t,n)&&(t.collie=2,t.y=n.y+n.height)}}t.collie=null}function m(t,e){const i=t.$potate.getState();if("jump"!==i&&"fall"!==i){for(const i in e){const n=e[i];if(this.geometry.tangent(t,n))return}t.$potate.setState("fall")}}function w(){const t=h.unit.filter(t=>"enemy"===t.type);for(const e in t){const i=t[e];!0===i.dead&&h.unit.del(i.id)}}function y(){return{created(){const t=new a({config:{id:e="test"},created(){this.graphics.image("bg",e,!0)}});var e;this.width=t.width,this.height=t.height;let i=[];[[8,0,3,5,1],[9,5,3,1,1],[6,5,4,1,7],[8,6,11,5,1],[9,11,11,1,1],[6,11,11,1,4],[3,11,15,1,1],[2,0,15,11,1],[8,0,19,20,1]].forEach(t=>{i.push(new a(p("block",t)))});[[7,4,3],[11,5,1],[9,7,3],[7,9,3],[13,12,1],[13,14,1],[13,16,3],[17,17,1]].forEach(t=>{i.push(new a(p("flat",t)))});const n=new a(f());this.camera.follow(n),new a(function(){return{config:{id:"exp",layer:4,fixed:1},data:{exp:0,expNeed:10},created(){this.graphics.draw(t),this.$pox.watch("player.exp",t=>{this.exp=t})}};function t(t){t.strokeStyle="black",t.strokeRect(10,10,50,10),t.fillStyle="#37b35e",t.fillRect(11,11,50*this.exp/this.expNeed,8)}}());[[1,150,78,"left"],[2,200,334,"right"],[3,280,590,"right"]].forEach(t=>{new a(function(t,e,i,n){return{config:{id:"pig"+t,x:e,y:i,width:19,height:18,offsetLeft:-10,offsetTop:-10,direction:n},data:{type:"enemy",hp:2,hitting:!1,dead:!1},methods:{stop(){this.graphics.animation("pig","idle")},hit(){this.hitting||0===this.hp||(this.hitting=!0,this.hp--,this.graphics.animation("pig","hit").onComplete=()=>{this.event.add("wait",function(t,e){let i=0;return function(){i++,i===t&&(this.event.del("wait"),e())}}(16,()=>{this.hitting=!1,0===this.hp?this.die():this.stop()}))})},die(){this.graphics.animation("pig","dead").onComplete=()=>{this.dead=!0}}},created(){this.stop()},destroyed(){this.$pox.set("deaths",t=>t+1)}}}(...t))}),new a(function(){return{config:{id:"touch",x:45,width:70,height:70,fixed:1,layer:5},data:{moveTouchId:null,touchX:0,touchY:0,moveRange:null,attackRange:null,jumpRange:null,walk:null},methods:{calTouches(t){let i=!1;for(const n of t)"touchstart"===n.type&&(null===this.moveTouchId&&e(n,this.moveRange)&&(this.moveTouchId=n.id,this.setTouch(n)),null!==this.moveTouchId&&(i=!0),!0!==this.$pox.get("attack")&&e(n,this.attackRange)&&this.$pox.set("attack",()=>!0),!0!==this.$pox.get("jump")&&e(n,this.jumpRange)&&this.$pox.set("jump",()=>!0)),"touchmove"===n.type&&this.moveTouchId===n.id&&(n.x=Math.min(n.x,this.x+this.width/2),n.x=Math.max(n.x,this.x-this.width/2),n.y=Math.min(n.y,this.y+this.height/2),n.y=Math.max(n.y,this.y-this.height/2),i=!0,this.setTouch(n)),"touchend"===n.type&&n.id===this.moveTouchId&&(i=!0);i||(this.moveTouchId=null,this.walk=null,this.touchX=this.x,this.touchY=this.y,this.$pox.set("walk",()=>null))},setTouch(t){this.touchX=t.x,this.touchY=t.y,this.touchX>this.x?this.walk="right":this.walk="left",this.$pox.get("walk")!==this.walk&&this.$pox.set("walk",()=>this.walk)}},created(){this.y=this.game.height-this.height+25,this.touchX=this.x,this.touchY=this.y,this.moveRange={x:this.x,y:this.y,radius:35},this.attackRange={x:this.game.width-65,y:this.y+14,radius:18},this.jumpRange={x:this.game.width-25,y:this.y+14,radius:18},this.graphics.draw(t),this.$pox.watch("touch",t=>{this.calTouches(t)})}};function t(t){function e(e,i){t.fillStyle="white",t.globalAlpha=i,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI),t.fill(),t.closePath()}function i(e,i,n){t.font="10px pixel",t.fillStyle="red",t.fillText(n,e,i)}e(this.moveRange,.2),e({x:this.touchX,y:this.touchY,radius:15},.7),e(this.attackRange,.7),i(this.game.width-81,this.y+14,"attack"),e(this.jumpRange,.7),i(this.game.width-37,this.y+14,"jump")}function e(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=Math.pow(e.radius,2)}}()),this.event.add(g,n,i),this.event.add(m,n,i),this.event.add(function(t){let e=!1;return function(){if(t.attacking&&!e){e=!0;const i=h.unit.filter(t=>"enemy"===t.type);for(const e in i){const n=i[e];this.geometry.distance("y",t,n)<30&&this.geometry.distance("x",t,n)<20&&this.geometry.distance("x",t,n)>0&&(this.geometry.onLeft(t,n)&&"right"===t.direction||this.geometry.onRight(t,n)&&"left"===t.direction)&&n.hit()}}t.attacking||(e=!1)}}(n)),this.event.add(w)}}}function x(){return{created(){new a(function(){return{config:{id:"titleImg"},data:{lastY:null},created(){this.graphics.image("title","title",!0),this.x=(this.game.width-this.width)/2,this.y=this.game.height,this.lastY=(this.game.height-this.height)/3+20,this.event.add("move",t),this.userEvent.watch("touchend",e)}};function t(){this.y>=this.lastY?this.y-=2:(this.event.del("move"),this.$pox.set("start",()=>!0))}function e(t){this.y<=this.lastY?new u(y()):this.y=this.lastY}}()),new a(function(){return{config:{id:"titleText"},data:{count:0},methods:{draw(){const t="press 'space' to start";this.graphics.draw(e=>{e.font="12px pixel",e.fillStyle="white",e.fillText(t,(this.game.width-e.measureText(t).width)/2,this.game.height/3*2+10)})}},created(){this.$pox.watch("start",()=>{this.draw(),this.event.add("twinkling",t)})}};function t(){this.count++,this.count>=25&&(this.alpha=this.alpha?0:1,this.count=0)}}())}}}function v(t){let e={};return function(){const i=this.id;e[i]={},this.$pox={watch(t,n){e[i][t]=n},unwatch(t){delete e[i][t]},set(i,n){const a=i.split("."),o=a.pop();let s=t;a.forEach(t=>{s=s[t]});const h=s[o],r=n(h);h!==r&&(s[o]=r,function(t,i){for(const n in e){const a=e[n];for(const e in a)e===t&&a[e](i)}}(i,r))},get(e){const i=e.split(".");let n=t;return i.forEach(t=>{n=n[t]}),n}}}}function b(){let t={},e=null;const i=this;this.$potate={addState(e,i,n){t[e]={action:i,condition:n}},setState(n){if(e===n)return!1;if(null!=e){const i=t[e].condition;if(i&&!i(n))return!1}e=n;const a=t[e].action;return a&&a.call(i),!0},getState:()=>e}}console.log("Potato | version:0.3.1 | author:Roanne"),function(){h.init({el:"app",width:320,height:240,path:{image:"./imgs/",audio:"./audio/"}}),h.asset.load({type:"image",group:"title",name:"title",url:"kings-and-pigs.png"});[{group:"player",width:78,interval:8,path:"kingHuman/",animations:[{url:"Idle.png",name:"idle"},{url:"Walk.png",name:"walk"},{url:"Attack.png",name:"attack"},{url:"Hit.png",name:"hit"}],images:[{url:"Jump.png",name:"jump"},{url:"Fall.png",name:"fall"},{url:"Ground.png",name:"ground"}]},{group:"pig",width:34,interval:8,flip:!0,path:"pig/",animations:[{url:"Idle.png",name:"idle"},{url:"Walk.png",name:"walk"},{url:"Attack.png",name:"attack"},{url:"Hit.png",name:"hit"},{url:"Dead.png",name:"dead"}],images:[{url:"Jump.png",name:"jump"},{url:"Fall.png",name:"fall"},{url:"Ground.png",name:"ground"}]}].forEach(t=>{t.animations.forEach(e=>{h.asset.load({type:"animation",group:t.group,name:e.name,url:t.path+e.url,width:t.width,interval:t.interval,flip:t.flip})}),t.images.forEach(e=>{h.asset.load({type:"image",group:t.group,name:e.name,url:t.path+e.url})})}),h.asset.load({type:"image",group:"bg",name:"test",url:"background/test.png"}),h.test=!1;h.mix(a,v({deaths:0,player:{hp:3,attack:1,exp:0,level:1}})),h.mix(a,b),new u(x())}()}]);