!function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function a(t){var e={},i=[];return{add(a){if(e[a.id])throw new Error(`Sprite '${a.id}' exists.`);var n;return a.game={width:t.width,height:t.height},a.stage={width:t.stage.width,height:t.stage.height},e[a.id]=a,-1===i.indexOf(a.layer)&&(i.push(a.layer),i.sort()),n={},i.forEach((function(t){for(var i in e){var a=e[i];a.layer===t&&(n[a.id]=a,delete e[i])}})),e=n,a},del(i){var a=e[i];if(!a)throw new Error(`Unit ${i} doesn't exist`);a.beforeDestroy&&a.beforeDestroy(),delete t.userEvents[i],a.audio.clear(),delete e[i],a.destroyed&&a.destroyed()},clear(t){for(var i in e){var a=e[i];!t&&a.global||this.del(i)}},find:t=>e[t],filter(t){var i={};for(var a in e){var n=e[a];!0===t(n)&&(i[a]=n)}return i},travel(t){for(var i in e)if(!1===t(e[i]))break}}}i.r(e);var n={};function o(t,e){var i=n.userEvents;for(var a in i){var o=i[a];o[t]&&o[t](e)}}n.init=function(t){var e,i,h;this.canvas=document.getElementById(t.el),this.width=t.width,this.height=t.height,this.scale=this.canvas.clientHeight/this.height,this.mode=t.mode,this.key=null,this.userEvents={},this.animationInterval=t.animationInterval||16,this.test=!1,this.isMobile=(e="undefined"!=typeof window&&window.navigator.userAgent.toLowerCase(),i=e&&e.indexOf("android")>0,h=e&&/iphone|ipad|ipod|ios/.test(e),!(!i&&!h)),this.imagePath=t.path?t.path.image:"",this.audioPath=t.path?t.path.audio:"",this.asset=function(t){var e=t.imagePath,i=t.audioPath,a=[],n={};return{allLoaded(t){a.length>0?Promise.all(a).then((function(){t()})):t()},get:(t,e)=>n[t][e],load(o){var h=o.type,s=o.group,r=o.name,l=o.url;if(n[s]||(n[s]={}),!n[s][r]){if("image"===h){var d=new Image;return a.push(new Promise((function(t){d.onload=function(){n[s][r]=d,t(!0)}}))),void(d.src=e+l)}if("animation"===h){d=new Image;return a.push(new Promise((function(e){d.onload=function(){switch(t.mode){case 0:n[s][r]={image:d,frame:o.frame,interval:o.interval,flip:o.flip};break;case 1:n[s][r]={image:d}}e(!0)}}))),void(d.src=e+l)}"audio"===h&&(n[s][r]=new Audio(i+l))}}}}(this),this.unit=a(this),this.mix=function(t,e){t.mixins||(t.mixins=[]),t.mixins.push(e)},this.canvas.setAttribute("width",this.width+"px"),this.canvas.setAttribute("height",this.height+"px");var s=window.addEventListener;s("keydown",(function(t){t.stopPropagation(),t.preventDefault();var e=t.key;n.key!==e&&(n.key=e,o("keydown",e))})),s("keyup",(function(t){t.stopPropagation(),t.preventDefault();var e=t.key;n.key===e&&(n.key=null),o("keyup",e)})),["mousedown","mouseup"].forEach((function(t){s(t,(function(e){e.stopPropagation(),e.preventDefault(),n.isMobile||o(t,function(t){var e=n.canvas,i=n.scale;return{x:(t.clientX-e.offsetLeft)/i,y:(t.clientY-e.offsetTop)/i,button:t.button}}(e))}))})),["touchstart","touchmove","touchend"].forEach((function(t){s(t,(function(e){o(t,function(t){for(var e=n.canvas,i=n.scale,a=[],o=0;o<t.targetTouches.length;o++){var h=t.targetTouches[o];a.push({x:(h.clientX-e.offsetLeft)/i,y:(h.clientY-e.offsetTop)/i,id:h.identifier,type:t.type})}return a}(e))}))})),window.oncontextmenu=function(){return!1}};var h=n;function s(t){var e={x:0,y:0,scale:1,follow:null,movement:null},i=function(i,a,n,o,s=!0){var r=60*n||1,l=i/r,d=a/r;if(0!==l||0!==d){e.follow=null;var c=t.width,u=t.height,f=h.width,p=h.height,g=0;!0===s&&h.unit.travel((function(t){t.disabled=!0})),e.movement=function(){if(e.x+=l,e.y+=d,++g>r||e.x<0||e.x>c-f||e.y<0||e.y>u-p)return e.x=Math.max(0,e.x),e.x=Math.min(e.x,c-f),e.y=Math.max(0,e.y),e.y=Math.min(e.y,u-p),e.movement=null,!0===s&&h.unit.travel((function(t){t.disabled=!1})),void(o&&o())}}};function a(e){var i=e.x,a=e.y,n=e.width,o=e.height,s=t.width,r=t.height,l=h.width,d=h.height;return{x:i<(l-n)/2?0:i>s-(l+n)/2?s-l:i-(l-n)/2,y:a<(d-o)/2?0:a>r-(d+o)/2?r-d:a-(d-o)/2}}return{follow(t){t!==e.follow&&(e.follow=t)},update:()=>(function(){var t=e.follow;if(t){var i=a(t);e.x=i.x,e.y=i.y}else e.movement&&e.movement()}(),e),move(t,e,a,n){i(t,e,a,n)},moveTo(t,n,o){var{x:h,y:s}=a(t);i(h-e.x,s-e.y,n,o)},unFollow(){e.follow=null}}}var r=function t(e){var i=this;h.asset.allLoaded((function(){h.stage&&h.stage.execute.destory(),i.beforeCreate=e.beforeCreate,i.created=e.created,i.beforeUpdate=e.beforeUpdate,i.updated=e.updated,i.beforeDestroy=e.beforeDestroy,i.destoryed=e.destoryed,i.beforeCreate&&i.beforeCreate(),h.key=null,h.stage=i;var a=e.config;i.width=a&&a.width||h.width,i.height=a&&a.height||h.height,i.camera=s(i),i.event=function(t){var e={};return{add(i,a,...n){e[i]&&reutrn,e[i]=a.bind(t,...n)},del(t){e[t]&&delete e[t]},execute(){for(var i in e)e[i].call(t)}}}(i),i.geometry=function(){function t(t,e){return{x1:t.x,y1:t.y,w1:t.width,h1:t.height,x2:e.x,y2:e.y,w2:e.width,h2:e.height}}return{above(e,i){var{x1:a,y1:n,w1:o,h1:h,x2:s,y2:r,w2:l}=t(e,i);return n+h<=r&&a+o>=s&&a<=s+l},contain(e,i){var{x1:a,y1:n,w1:o,h1:h,x2:s,y2:r,w2:l,h2:d}=t(e,i);return!(o<l&&h<d&&(a<=s||a+o>=s+l)&&(n<=r||n+h>=r+d))},distance(e,i,a){var{x1:n,y1:o,w1:h,h1:s,x2:r,y2:l,w2:d,h2:c}=t(i,a);if("y"===e)return l>o+s?l-(o+s):o>l+c?o-(l+c):0;if("x"===e)return r>n+h?r-(n+h):n>r+d?n-(r+d):0;if("o"===e){var u=[n+h/2,o+s/2],f=[r+d/2,l+c/2];return Math.sqrt((u[0]-f[0])**2+(u[1]-f[1])**2)}},intersect(e,i){var{x1:a,y1:n,w1:o,h1:h,x2:s,y2:r,w2:l,h2:d}=t(e,i);return!(a>=s+l||a+o<=s||n>=r+d||n+h<=r)},onRight(e,i){var{x1:a,y1:n,h1:o,x2:h,y2:s,w2:r,h2:l}=t(e,i);return a>=h+r&&n+o>=s&&n<=s+l},onLeft(e,i){var{x1:a,y1:n,w1:o,h1:h,x2:s,y2:r,h2:l}=t(e,i);return a+o<=s&&n+h>=r&&n<=r+l},tangent(e,i){var{x1:a,y1:n,w1:o,h1:h,x2:s,y2:r,w2:l,h2:d}=t(e,i);return!(a>s+l||a+o<s||n>r+d||n+h<r)},under(e,i){var{x1:a,y1:n,w1:o,x2:h,y2:s,w2:r,h2:l}=t(e,i);return n>=s+l&&a+o>=h&&a<=h+r}}}(),i.execute=function(t){var e=h.canvas.getContext("2d"),i=!1;function a(){if(!i){t.beforeUpdate&&t.beforeUpdate();var n=t.camera.update();t.event.execute(),e.clearRect(0,0,h.width,h.height),h.unit.travel((function(t){!function(t,e){t.beforeUpdate&&t.beforeUpdate(),t.relX=t.x-e.x*(1-t.fixed),t.relY=t.y-e.y*(1-t.fixed),t.audio.update(),t.graphics.render(),t.event.execute(),t.updated&&t.updated()}(t,n)})),t.updated&&t.updated(),window.requestAnimationFrame(a)}}return{destory(){t.beforeDestroy&&t.beforeDestroy(),i=!0,h.unit.clear(),t.destoryed&&t.destoryed()},loop(){a()}}}(i),t.mixins&&t.mixins.forEach((function(t){t.call(i)})),i.created&&i.created.call(i),i.execute.loop()}))};function l(t){var e=h.canvas.getContext("2d"),i=Math.floor,a=null,n=function(e,i,a){t.drawWidth=e,t.drawHeight=i,a&&(t.width=e,t.height=i)},o=function(){return{relX:t.relX,relY:t.relY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,width:t.width,height:t.height,drawWidth:t.drawWidth,drawHeight:t.drawHeight,scale:t.scale,direction:t.direction}},s=function(t){var{relX:a,relY:n,offsetLeft:s,offsetTop:l,width:d,drawWidth:c,drawHeight:u,scale:f,direction:p}=o();if("right"===p){var g=i(a+s),m=i(n+l);e.drawImage(t,0,0,c,u,g,m,c*f,u*f)}else{g=i(h.width-d*f-a+s),m=i(n+l);r(h.width,(function(){e.drawImage(t,0,0,c,u,g,m,c*f,u*f)}))}};function r(t,i){e.translate(t,0),e.scale(-1,1),i(),e.translate(t,0),e.scale(-1,1)}return{animation(s,l,d=!1){var c=h.asset.get(s,l);if(0===h.mode){n(c.image.width/c.frame,c.image.height,d);var u={animationFrames:c.frame,animationInterval:c.interval||h.animationInterval,width:t.drawWidth,height:t.drawHeight,flip:c.flip,onComplete:null}}else{n(c.image.width/4,c.image.height/4,d);u={animationFrames:4,animationInterval:c.interval||h.animationInterval,width:t.drawWidth,height:t.drawHeight,onComplete:null,play(){g=!0},stop(){g=!1,p=0}}}var f=0,p=0,g=0===h.mode;return a=function(){!function(t,a,n){var{relX:s,relY:l,offsetLeft:d,offsetTop:c,width:u,drawWidth:f,drawHeight:p,scale:g,direction:m}=o();if(0===h.mode)if(!n&&"right"===m||n&&"left"===m){var w=i(s+d),v=i(l+c);e.drawImage(t,a*f,0,f,p,w,v,f*g,p*g)}else{w=i(h.width-u*g-s+d),v=i(l+c);r(h.width,(function(){e.drawImage(t,a*f,0,f,p,w,v,f*g,p*g)}))}else{w=i(s+d),v=i(l+c);switch(m){case"down":e.drawImage(t,a*f,0,f,p,w,v,f*g,p*g);break;case"left":e.drawImage(t,a*f,p,f,p,w,v,f*g,p*g);break;case"right":e.drawImage(t,a*f,2*p,f,p,w,v,f*g,p*g);break;case"up":e.drawImage(t,a*f,3*p,f,p,w,v,f*g,p*g)}}}(c.image,p,u.flip),g&&++f>=u.animationInterval&&(f=0,++p>=u.animationFrames&&(p=0,u.onComplete&&u.onComplete.call(this)))},t.animation=u,u},clear(){a=null},draw(i){a=function(){i.call(t,e)}},image(t,e,i=!1){var o=h.asset.get(t,e);n(o.width,o.height,i),a=function(){s(o)}},mix(t,i){var n=h.canvas.cloneNode(),o=n.getContext("2d"),s=new Image;"static"===t?(o.clearRect(0,0,h.width,h.height),i(o),s.src=n.toDataURL("image/png"),a=function(){e.drawImage(s,0,0)}):"dynamic"===t&&(a=function(){o.clearRect(0,0,h.width,h.height),i(o),s.src=n.toDataURL("image/png"),e.drawImage(s,0,0)})},particle(e,i,n,o,r){var l,d,c=h.asset.get(e,i);t.width=0,t.height=0,t.drawWidth=c.width,t.drawHeight=c.height,o&&(l=(o[1]-o[0])/n),r&&(d=(r[1]-r[0])/n,t.scale=r[1]),a=function(){null!=l&&((t.alpha+l<=o[0]||t.alpha+l>=o[1])&&(l=-l),t.alpha+=l),null!=d&&((t.scale+d<=r[0]||t.scale+d>=r[1])&&(d=-d),t.scale+=d),s(c)}},render(){var i=h.width,n=h.height,o=t.relX,s=t.relY,r=t.width,l=t.height,d=t.scale;o+r*d<0||o>i||s+l*d<0||s>n||(e.globalAlpha=t.alpha,a&&a(),h.test&&(e.strokeStyle="red",e.strokeRect(t.relX,t.relY,t.width,t.height)))}}}var d=function t(e){this.beforeCreate=e.beforeCreate,this.created=e.created,this.beforeUpdate=e.beforeUpdate,this.updated=e.updated,this.beforeDestroy=e.beforeDestroy,this.destroyed=e.destroyed,this.beforeCreate&&this.beforeCreate();var i=e.config;if(!i.id)throw Error("Sprite need an id.");if(this.id=i.id,this.x=i.x||0,this.y=i.y||0,this.width=i.width||0,this.height=i.height||0,this.offsetLeft=i.offsetLeft||0,this.offsetTop=i.offsetTop||0,this.global=i.global||!1,this.alpha=null==i.alpha?1:i.alpha,this.scale=null==i.scale?1:i.scale,this.direction=i.direction||"right",this.layer=i.layer||0,this.disabled=i.disabled||!1,this.fixed=i.fixed||0,null==this.id)throw new Error("Sprite needs an id.");if(this.id instanceof Number||!isNaN(Number(this.id)))throw new Error("Sprite must start with a letter.");for(var a in e.data)this[a]=e.data[a];for(var a in e.methods)this[a]=e.methods[a];if(this.graphics=l(this),this.audio=function(t){var e={audio:null},i=[];return{update(){if(e.audio||0!==i.length){var a=t.relX,n=t.relY,o=Math.sqrt(a**2+n**2);if(e.audio&&e.range>0){var h=e.range;d(r=e.audio,h,e.defalutVolume,o)}for(var s=0;s<i.length;s++){var r,l=i[s];h=l.range;!0!==(r=l.audio).ended?d(r,h,l.defalutVolume,o):(i.splice(s,1),r.remove(),s--)}}function d(t,e,i,a){e&&(t.volume=a>=e?0:i*((e-a)/e))}},play(t){var a=t.type,n=t.group,o=t.name,s=t.range||0,r=t.volume||1,l=t.startTime||0,d=t.loop||!0,c=h.asset.get(n,o);if("sound"===a){var u=c.cloneNode();return u.volume=r,u.currentTime=l,u.play(),void i.push({audio:u,defalutVolume:r,range:s})}"music"===a&&(e.audio!==c&&(e.audio=c,e.defalutVolume=r,e.range=s,c.currentTime=l,c.volume=r,c.loop=d),c.play())},stop(){e.pause(),e.currentTime=0},clear(){e.audio&&e.audio.remove(),i.forEach((function(t){t.audio.remove()}))}}}(this),this.event=function(t){var e={};return{add(t,i){e[t]||(e[t]=i)},del(t){e[t]&&delete e[t]},delAll(){e={}},execute(){if(!t.disabled)for(var i in e)e[i].call(t)}}}(this),this.userEvent=function(t){var e=h.userEvents;return{watch(i,a){e[t.id]||(e[t.id]={}),e[t.id][i]=a.bind(t)},unwatch(i){i&&e[t.id]&&e[t.id][i]&&delete h.userEvents[t.id][i]}}}(this),t.mixins){var n=this;t.mixins.forEach((function(t){t.call(n)}))}h.unit.add(this),e.created&&e.created.call(this)};function c(t){return{config:{id:"player",x:10,y:66,width:28,height:30,offsetLeft:-19,offsetTop:-13,direction:"right",layer:1},data:{exp:0,collie:null,state:"stop",speed:2,waiting:!1,attacking:!1,walkDirection:null,vSpeed:0},methods:{walk(){this.direction=this.walkDirection,this.graphics.animation(this.id,"walk")},stop(){this.walkDirection=null,this.graphics.animation(this.id,"idle")},attack(){this.event.add("wait",this.wait(4,()=>{this.attacking=!0,this.graphics.animation(this.id,"attack").onComplete=()=>{this.restore()}}))},jump(){this.graphics.image(this.id,"jump"),this.vSpeed=8},fall(){this.jumpTop=this.y,this.graphics.image(this.id,"fall")},ground(){this.vSpeed=0,this.y-this.jumpTop>96?(this.graphics.image(this.id,"ground"),this.event.add("wait",this.wait(6,()=>{this.restore()}))):this.restore()},hit(){this.graphics.animation(this.id,"hit").onComplete=()=>{this.event.add("wait",this.wait(8,()=>{this.restore()}))}},restore(){this.waiting=!1,this.attacking=!1,this.$pox.set("jump",()=>!1),this.$pox.set("attack",()=>!1),this.walkDirection?this.$potate.setState("walk"):this.$potate.setState("stop")},wait(t,e){let i=0;return this.waiting=!0,()=>{i++,i>=t&&(this.event.del("wait"),e())}}},created(){e.call(this),i.call(this),a.call(this,t)}};function e(){t?(this.userEvent.watch("touchstart",n),this.userEvent.watch("touchmove",n),this.userEvent.watch("touchend",n)):(this.userEvent.watch("keydown",o),this.userEvent.watch("keyup",h),this.userEvent.watch("mousedown",s)),this.event.add("walkMove",r),this.event.add("jumpMove",l)}function i(){const t=this.$potate.addState;t("stop",this.stop),t("walk",this.walk),t("ground",this.ground,t=>!this.waiting&&("stop"===t||"walk"===t||void 0)),t("attack",this.attack,t=>!this.waiting&&("stop"===t||"walk"===t||void 0)),t("jump",this.jump,t=>{if("fall"===t)return!0}),t("fall",this.fall,t=>{if("ground"===t)return!0}),t("hit",this.hit,t=>{if("stop"===t)return!0}),this.$potate.setState("stop")}function a(t){const e=this.$pox.watch,i=this.$potate.setState,a=this.$potate.getState;e("deaths",()=>{this.$pox.set("player.exp",t=>t+1)}),t&&(e("walk",t=>{this.walkDirection=t,null!==t?"walk"===a()?this.direction=t:i("walk"):"walk"===a()&&i("stop")}),e("jump",t=>{t&&i("jump")}),e("attack",t=>{t&&i("attack")}))}function n(t){this.$pox.set("touch",()=>t)}function o(t){const e=this.$potate.getState();switch(t){case"d":this.walkDirection="right","walk"===e||"jump"===e||"fall"===e?this.direction=this.walkDirection:this.$potate.setState("walk");break;case"a":this.walkDirection="left","walk"===e||"jump"===e||"fall"===e?this.direction=this.walkDirection:this.$potate.setState("walk");break;case" ":this.$potate.setState("jump")}}function h(t){switch(t){case"a":"left"===this.direction&&"left"===this.walkDirection&&(this.walkDirection=null,this.$potate.setState("stop"));break;case"d":"right"===this.direction&&"right"===this.walkDirection&&(this.walkDirection=null,this.$potate.setState("stop"))}}function s(){this.$potate.setState("attack")}function r(){const t=this.$potate.getState();this.walkDirection&&"attack"!==t&&"ground"!==t&&("right"===this.direction&&this.x<this.stage.width-this.width?this.x+=this.speed:"left"===this.direction&&this.x>0&&(this.x-=this.speed))}function l(){const t=this.$potate.getState();"jump"!==t&&"fall"!==t||(this.y-=this.vSpeed,this.vSpeed>-4&&(this.vSpeed-=.5,0===this.vSpeed&&this.$potate.setState("fall")))}}function u(t,e){return"block"===t?{config:{id:"block"+Math.random(),x:32*e[1],y:32*e[2],layer:1,width:32*e[3],height:32*e[4]},data:{type:t,collieType:e[0]}}:{config:{id:"flat"+Math.random(),x:32*e[0],y:32*e[1],layer:1,width:32*e[2],height:10},data:{type:t,collieType:8}}}function f(t,e){for(const i in e){const a=e[i];switch(a.collieType){case 8:if(this.geometry.above(t,a)&&this.geometry.distance("y",t,a)<-t.vSpeed)return t.collie=8,t.y=a.y-t.height,void("fall"===t.$potate.getState()&&t.$potate.setState("ground"));break;case 9:if(this.geometry.above(t,a)){if(this.geometry.distance("y",t,a)<-t.vSpeed)return t.collie=8,t.y=a.y-t.height,void("fall"===t.$potate.getState()&&t.$potate.setState("ground"))}else this.geometry.intersect(t,a)&&(t.collie=6,t.x=a.x+a.width);break;case 6:this.geometry.intersect(t,a)&&(t.collie=6,t.x=a.x+a.width);break;case 3:if(2===t.collie&&t.vSpeed>=0)return void(t.y=a.y+a.height);if(this.geometry.under(t,a)){if(this.geometry.distance("y",t,a)<t.vSpeed)return t.collie=2,void(t.y=a.y+a.height)}else if(this.geometry.intersect(t,a))return t.collie=6,void(t.x=a.x+a.width);break;case 2:this.geometry.intersect(t,a)&&(t.collie=2,t.y=a.y+a.height)}}t.collie=null}function p(t,e){const i=t.$potate.getState();if("jump"!==i&&"fall"!==i){for(const i in e){const a=e[i];if(this.geometry.tangent(t,a))return}t.$potate.setState("fall")}}function g(){const t=h.unit.filter(t=>"enemy"===t.type);for(const e in t){const i=t[e];!0===i.dead&&h.unit.del(i.id)}}function m(t,e){e.forEach(e=>{"die"!==e.$potate.getState()&&(e.stay&&this.geometry.distance("o",e,t)<=50&&(e.stay=!1,e.$potate.setState("walk")),e.stay||(e.direction=t.x<e.x?"left":"right",this.geometry.distance("o",e,t)<=60?this.geometry.distance("o",e,t)<=20?e.$potate.setState("attack"):e.$potate.setState("walk"):(e.stay=!0,e.$potate.setState("stop"))))})}function w(){return{created(){const t=new d({config:{id:e="test"},created(){this.graphics.image("bg",e,!0)}});var e;this.width=t.width,this.height=t.height;let i=[];[[8,0,3,5,1],[9,5,3,1,1],[6,5,4,1,7],[8,6,11,5,1],[9,11,11,1,1],[6,11,11,1,4],[3,11,15,1,1],[2,0,15,11,1],[8,0,19,20,1]].forEach(t=>{i.push(new d(u("block",t)))});[[7,4,3],[11,5,1],[9,7,3],[7,9,3],[13,12,1],[13,14,1],[13,16,3],[17,17,1]].forEach(t=>{i.push(new d(u("flat",t)))});const a=new d(c(h.isMobile));this.camera.follow(a),new d(function(){return{config:{id:"exp",layer:4,fixed:1},data:{exp:0,expNeed:10},created(){this.graphics.draw(t),this.$pox.watch("player.exp",t=>{this.exp=t})}};function t(t){t.strokeStyle="black",t.strokeRect(10,10,50,10),t.fillStyle="#37b35e",t.fillRect(11,11,50*this.exp/this.expNeed,8)}}());const n=[[1,150,78,"left"],[2,200,334,"right"],[3,280,590,"right"]];n.forEach((t,e)=>{n[e]=new d(function(t,e,i,a){return{config:{id:"pig"+t,x:e,y:i,width:19,height:18,offsetLeft:-10,offsetTop:-10,direction:a,layer:2},data:{type:"enemy",hp:2,speed:1,stay:!0,hitting:!1,dead:!1},methods:{stop(){this.graphics.animation("pig","idle")},walk(){this.graphics.animation("pig","walk")},attack(){this.graphics.animation("pig","attack")},hit(){this.hitting||0===this.hp||(this.hitting=!0,this.hp--,this.graphics.animation("pig","hit").onComplete=()=>{this.event.add("wait",function(t,e){let i=0;return function(){i++,i===t&&(this.event.del("wait"),e())}}(16,()=>{this.hitting=!1,0===this.hp?this.$potate.setState("die"):this.$potate.setState("stop")}))})},die(){this.graphics.animation("pig","dead").onComplete=()=>{this.dead=!0}}},created(){this.$potate.addState("stop",this.stop),this.$potate.addState("walk",this.walk),this.$potate.addState("hit",this.hit,()=>!this.hitting),this.$potate.addState("attack",this.attack),this.$potate.addState("die",this.die,()=>!1),this.$potate.setState("stop"),this.event.add("move",n)},destroyed(){this.$pox.set("deaths",t=>t+1)}};function n(){"walk"===this.$potate.getState()&&(this.x+="right"===this.direction?1:-1)}}(...t))}),h.isMobile&&new d(function(){return{config:{id:"touch",x:45,width:70,height:70,fixed:1,layer:5},data:{moveTouchId:null,touchX:0,touchY:0,moveRange:null,attackRange:null,jumpRange:null,walk:null},methods:{calTouches(t){let i=!1;for(const a of t)"touchstart"===a.type&&(null===this.moveTouchId&&e(a,this.moveRange)&&(this.moveTouchId=a.id,this.setTouch(a)),null!==this.moveTouchId&&(i=!0),!0!==this.$pox.get("attack")&&e(a,this.attackRange)&&this.$pox.set("attack",()=>!0),!0!==this.$pox.get("jump")&&e(a,this.jumpRange)&&this.$pox.set("jump",()=>!0)),"touchmove"===a.type&&this.moveTouchId===a.id&&(a.x=Math.min(a.x,this.x+this.width/2),a.x=Math.max(a.x,this.x-this.width/2),a.y=Math.min(a.y,this.y+this.height/2),a.y=Math.max(a.y,this.y-this.height/2),i=!0,this.setTouch(a)),"touchend"===a.type&&a.id===this.moveTouchId&&(i=!0);i||(this.moveTouchId=null,this.walk=null,this.touchX=this.x,this.touchY=this.y,this.$pox.set("walk",()=>null))},setTouch(t){this.touchX=t.x,this.touchY=t.y,this.touchX>this.x?this.walk="right":this.walk="left",this.$pox.get("walk")!==this.walk&&this.$pox.set("walk",()=>this.walk)}},created(){this.y=this.game.height-this.height+25,this.touchX=this.x,this.touchY=this.y,this.moveRange={x:this.x,y:this.y,radius:35},this.attackRange={x:this.game.width-65,y:this.y+14,radius:18},this.jumpRange={x:this.game.width-25,y:this.y+14,radius:18},this.graphics.draw(t),this.$pox.watch("touch",t=>{this.calTouches(t)})}};function t(t){function e(e,i){t.fillStyle="white",t.globalAlpha=i,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI),t.fill(),t.closePath()}function i(e,i,a){t.font="10px pixel",t.fillStyle="red",t.fillText(a,e,i)}e(this.moveRange,.2),e({x:this.touchX,y:this.touchY,radius:15},.7),e(this.attackRange,.7),i(this.game.width-81,this.y+14,"attack"),e(this.jumpRange,.7),i(this.game.width-37,this.y+14,"jump")}function e(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=Math.pow(e.radius,2)}}()),this.event.add("collie",f,a,i),this.event.add("gravity",p,a,i),this.event.add("hit",function(t){let e=!1;return function(){if(t.attacking&&!e){e=!0;const i=h.unit.filter(t=>"enemy"===t.type);for(const e in i){const a=i[e];this.geometry.distance("y",t,a)<30&&this.geometry.distance("x",t,a)<20&&this.geometry.distance("x",t,a)>0&&(this.geometry.onLeft(t,a)&&"right"===t.direction||this.geometry.onRight(t,a)&&"left"===t.direction)&&a.$potate.setState("hit")}}t.attacking||(e=!1)}}(a)),this.event.add("deadCheck",g),this.event.add("ai",m,a,n)}}}function v(){return{created(){new d(function(){return{config:{id:"titleImg"},data:{lastY:null},methods:{press(){this.y<=this.lastY?new r(w()):this.y=this.lastY}},created(){this.graphics.image("title","title",!0),this.x=(this.game.width-this.width)/2,this.y=this.game.height,this.lastY=(this.game.height-this.height)/3+20,this.event.add("move",t),this.userEvent.watch("touchend",()=>{this.press()}),this.userEvent.watch("keydown",t=>{" "===t&&this.press()})}};function t(){this.y>=this.lastY?this.y-=2:(this.event.del("move"),this.$pox.set("start",()=>!0))}}()),new d(function(){return{config:{id:"titleText"},data:{count:0},methods:{draw(){const t="press 'space' to start";this.graphics.draw(e=>{e.font="12px pixel",e.fillStyle="white",e.fillText(t,(this.game.width-e.measureText(t).width)/2,this.game.height/3*2+10)})}},created(){this.$pox.watch("start",()=>{this.draw(),this.event.add("twinkling",t)})}};function t(){this.count++,this.count>=25&&(this.alpha=this.alpha?0:1,this.count=0)}}())}}}function y(t){let e={};return function(){const i=this.id;e[i]={},this.$pox={watch(t,a){e[i][t]=a},unwatch(t){delete e[i][t]},set(i,a){const n=i.split("."),o=n.pop();let h=t;n.forEach(t=>{h=h[t]});const s=h[o],r=a(s);s!==r&&(h[o]=r,function(t,i){for(const a in e){const n=e[a];for(const e in n)e===t&&n[e](i)}}(i,r))},get(e){const i=e.split(".");let a=t;return i.forEach(t=>{a=a[t]}),a}}}}function x(){let t={},e=null;const i=this;this.$potate={addState(e,i,a){t[e]={action:i,condition:a}},setState(a){if(e===a)return!1;if(null!=e){const i=t[e].condition;if(i&&!i(a))return!1}e=a;const n=t[e].action;return n&&n.call(i),!0},getState:()=>e}}console.log("Potato | version:0.6.1 | author:Roanne"),function(){h.init({el:"app",width:320,height:240,path:{image:"./imgs/",audio:"./audio/"},mode:0}),h.asset.load({type:"image",group:"title",name:"title",url:"kings-and-pigs.png"});[{group:"player",interval:8,path:"kingHuman/",animations:[{url:"Idle.png",name:"idle",frame:11},{url:"Walk.png",name:"walk",frame:8},{url:"Attack.png",name:"attack",frame:3},{url:"Hit.png",name:"hit",frame:2}],images:[{url:"Jump.png",name:"jump"},{url:"Fall.png",name:"fall"},{url:"Ground.png",name:"ground"}]},{group:"pig",interval:8,flip:!0,path:"pig/",animations:[{url:"Idle.png",name:"idle",frame:11},{url:"Walk.png",name:"walk",frame:6},{url:"Attack.png",name:"attack",frame:5},{url:"Hit.png",name:"hit",frame:2},{url:"Dead.png",name:"dead",frame:4}],images:[{url:"Jump.png",name:"jump"},{url:"Fall.png",name:"fall"},{url:"Ground.png",name:"ground"}]}].forEach(t=>{t.animations.forEach(e=>{h.asset.load({type:"animation",group:t.group,name:e.name,url:t.path+e.url,frame:e.frame,interval:t.interval,flip:t.flip})}),t.images.forEach(e=>{h.asset.load({type:"image",group:t.group,name:e.name,url:t.path+e.url})})}),h.asset.load({type:"image",group:"bg",name:"test",url:"background/test.png"}),h.test=!1;h.mix(d,y({deaths:0,player:{hp:3,attack:1,exp:0,level:1}})),h.mix(d,x),new r(v())}()}]);